"use strict";(self["webpackChunkeslweb"]=self["webpackChunkeslweb"]||[]).push([[6252],{1661:function(e,a,t){t.r(a),t.d(a,{default:function(){return G}});var s=t(6252),n=t(8061),o=t(6612);const i=e=>((0,s.dD)("data-v-edcf71fc"),e=e(),(0,s.Cn)(),e),c={class:"conversations"},r={class:"conversation-list"},l={class:"conversation-list-container"},u={class:"conversation-list-top"},d={class:"conversation-list-top-label"},v=i((()=>(0,s._)("span",null,"Recent Messages",-1))),g=(0,s.Uk)(" History "),p={class:"conversation-list-top-search"},m={class:"conversation-list-content"},h={key:0},y=["onContextmenu"],w={class:"avatar"},k={key:0,class:"unread-count"},f={class:"unread"},C={class:"conversation-message"},D={class:"conversation-top"},M={class:"conversation-name"},_={class:"conversation-time"},I={class:"conversation-bottom"},S={key:0,class:"conversation-content"},b={key:0},E={key:1},N={key:1,class:"conversation-content"},U={key:0,class:"unread-text"},T={key:1},x={key:2},H={key:3,class:"text"},V={key:4},R={key:5},L={key:6},q={key:7},z={key:8},O={key:1,class:"no-conversation"},A={class:"chat"};function P(e,a,t,i,P,j){const F=(0,s.up)("el-button"),W=(0,s.up)("el-option"),J=(0,s.up)("el-select"),Y=(0,s.up)("el-avatar"),$=(0,s.up)("router-link"),K=(0,s.up)("el-empty"),G=(0,s.up)("router-view");return(0,s.wg)(),(0,s.iD)("div",c,[(0,s._)("div",r,[(0,s._)("div",l,[(0,s._)("div",u,[(0,s._)("div",d,[v,(0,s.Wm)(F,{type:"primary",round:"",onClick:a[0]||(a[0]=e=>i.turnHistory())},{default:(0,s.w5)((()=>[g])),_:1})]),(0,s._)("div",p,[(0,s.Wm)(J,{modelValue:i.chatSearchValue,"onUpdate:modelValue":a[1]||(a[1]=e=>i.chatSearchValue=e),filterable:"",clearable:"",remote:"","reserve-keyword":"","remote-method":i.chatSearchRemoteMethod,loading:i.chatSearchLoading,placeholder:"Search chats",onChange:i.chatLocationChange},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.chatSearchConversationData,(e=>((0,s.wg)(),(0,s.j4)(W,{key:e.userId,label:e.data.name,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","remote-method","loading","onChange"])])]),(0,s._)("div",m,[i.conversations.length?((0,s.wg)(),(0,s.iD)("div",h,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.conversations,((a,t)=>((0,s.wg)(),(0,s.j4)($,{replace:"",key:t,to:i.chatLocation(a)},{default:(0,s.w5)((()=>[(0,s._)("div",{class:"conversation",onContextmenu:(0,n.iM)((e=>i.showRightClickMenu(e,a)),["prevent","stop"])},[(0,s._)("div",w,[(0,s.Wm)(Y,{class:"avatar-img",src:a.data.avatar},null,8,["src"]),a.unread>0?((0,s.wg)(),(0,s.iD)("div",k,[(0,s._)("span",f,(0,o.zw)(a.unread),1)])):(0,s.kq)("",!0)]),(0,s._)("div",C,[(0,s._)("div",D,[(0,s._)("span",M,(0,o.zw)(a.data.name),1),(0,s._)("div",_,[(0,s._)("div",null,(0,o.zw)(e.formatDate(a.lastMessage.timestamp)),1)])]),(0,s._)("div",I,[a.lastMessage.recalled?((0,s.wg)(),(0,s.iD)("div",S,["private"===a.type?((0,s.wg)(),(0,s.iD)("div",b,(0,o.zw)(a.lastMessage.senderId===i.currentUser.uuid?"you":`"${a.data.name}"`)+" retracted a message ",1)):(0,s.kq)("",!0),"group"===a.type?((0,s.wg)(),(0,s.iD)("div",E,(0,o.zw)(a.lastMessage.senderId===i.currentUser.uuid?"you":`"${a.lastMessage.senderData.name}"`)+" retracted a message ",1)):(0,s.kq)("",!0)])):((0,s.wg)(),(0,s.iD)("div",N,[!1===a.lastMessage.read&&a.lastMessage.senderId===i.currentUser.uuid?((0,s.wg)(),(0,s.iD)("div",U," [unread] ")):(0,s.kq)("",!0),"private"===a.type?((0,s.wg)(),(0,s.iD)("div",T,(0,o.zw)(a.lastMessage.senderId===i.currentUser.uuid?"me":a.data.name)+": ",1)):((0,s.wg)(),(0,s.iD)("div",x,(0,o.zw)(a.lastMessage.senderId===i.currentUser.uuid?"me":a.lastMessage.senderData.name)+": ",1)),"text"===a.lastMessage.type?((0,s.wg)(),(0,s.iD)("span",H,(0,o.zw)(a.lastMessage.payload.text),1)):"video"===a.lastMessage.type?((0,s.wg)(),(0,s.iD)("span",V,"[Video messages]")):"audio"===a.lastMessage.type?((0,s.wg)(),(0,s.iD)("span",R,"[Voice messages]")):"image"===a.lastMessage.type?((0,s.wg)(),(0,s.iD)("span",L,"[Image messages]")):"file"===a.lastMessage.type?((0,s.wg)(),(0,s.iD)("span",q,"[File messages]")):"order"===a.lastMessage.type?((0,s.wg)(),(0,s.iD)("span",z,"[Order messages]")):(0,s.kq)("",!0)]))])])],40,y)])),_:2},1032,["to"])))),128))])):((0,s.wg)(),(0,s.iD)("div",O,[(0,s.Wm)(K,{description:"No Recent Messages"})]))])]),i.rightClickMenu.visible?((0,s.wg)(),(0,s.iD)("div",{key:0,style:(0,o.j5)({left:i.rightClickMenu.x+"px",top:i.rightClickMenu.y+"px"}),class:"action-box"},[(0,s._)("div",{class:"action-item",onClick:a[2]||(a[2]=(...e)=>i.topConversation&&i.topConversation(...e))},(0,o.zw)(i.rightClickMenu.conversation.top?"UNPIN":"PIN CHAT TO THE TOP"),1),(0,s._)("div",{class:"action-item",onClick:a[3]||(a[3]=(...e)=>i.deleteConversation&&i.deleteConversation(...e))},"DELETE CHATS")],4)):(0,s.kq)("",!0)]),(0,s._)("div",A,[((0,s.wg)(),(0,s.j4)(G,{key:e.$route.params.id}))])])}var j=t(2931),F=t(3907),W=t(4276),J=t(8339),Y={name:"chatConversations",setup(){const e=(0,F.oR)(),a=(0,J.tv)(),t=(0,s.f3)("GoEasy"),n=(0,s.f3)("goEasy"),o=e.state.currentUser;console.log(o);let i=(0,j.iH)([]),c=(0,j.qj)({conversation:null,visible:!1,x:null,y:null}),r=(0,j.iH)(""),l=(0,j.iH)(!1),u=(0,j.iH)([]);function d(){return a.push("/chat/history")}function v(e){e&&(l.value=!0,setTimeout((()=>{l.value=!1,u.value=i.value.filter((a=>a.data.name.toLowerCase().includes(e.toLowerCase())))}),200))}function g(){n.im.latestConversations({onSuccess:e=>{console.log(e);let a=e.content;m(a)},onFailed:e=>{console.log("获取最新会话列表失败, code:"+e.code+"content:"+e.content)}})}function p(){n.im.on(t.IM_EVENT.CONVERSATIONS_UPDATED,m)}function m(e){i.value=e.conversations}function h(e,a){c.conversation=a,c.visible=!0,c.x=e.pageX,c.y=e.pageY}function y(){c.visible=!1}function w(){let e=c.conversation,a=e.top?"UNPIN":"PIN";n.im.topConversation({conversation:e,top:!e.top,onSuccess:function(){console.log(a,"成功")},onFailed:function(e){console.log(a,"失败：",e)}})}function k(){if(confirm("Are you sure you want to delete this conversation？")){let e=c.conversation;n.im.removeConversation({conversation:e,onSuccess:function(){console.log("删除会话成功")},onFailed:function(e){console.log(e)}})}}function f(e){if(e){let t=e.userId,s=t.split("#"),n="private"===e.type?"/chat/messages/privatechat/"+s[0]:"/chat/messages/groupchat/"+e.groupId,o={uuid:e.userId,name:e.data.name,avatar:e.data.avatar};a.push({path:n,query:{str:encodeURI((0,W.cv)(JSON.stringify(o)))}})}}function C(e){console.log(e);let a=e.userId,t=a.split("#"),s="private"===e.type?"/chat/messages/privatechat/"+t[0]:"/chat/messages/groupchat/"+e.groupId,n={uuid:e.userId,name:e.data.name,avatar:e.data.avatar};return{path:s,query:{str:encodeURI((0,W.cv)(JSON.stringify(n)))}}}return(0,s.bv)((()=>{document.addEventListener("click",(()=>{y()})),p(),g()})),(0,s.Jd)((()=>{n.im.off(t.IM_EVENT.CONVERSATIONS_UPDATED,m)})),{currentUser:o,conversations:i,rightClickMenu:c,chatSearchValue:r,chatSearchLoading:l,chatSearchConversationData:u,chatSearchRemoteMethod:v,showRightClickMenu:h,topConversation:w,deleteConversation:k,chatLocation:C,chatLocationChange:f,turnHistory:d}}},$=t(8118);const K=(0,$.Z)(Y,[["render",P],["__scopeId","data-v-edcf71fc"]]);var G=K}}]);
//# sourceMappingURL=6252.b9cee655.js.map